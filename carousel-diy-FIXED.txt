{% doc %}
  @prompt
    CREATE NEW CAROUSEL SECTION
    LAYOUT STRUCTURE:
    * Two-column layout per slide
    * Left column: Image with 8px rounded corners and padding on all sides
    * Right column: Vertically centered content with left-aligned text
    RIGHT COLUMN CONTENT:
    * Header: Use <H2 class="h2"> (site typography)
    * Subhead: Use <p class="subheading"> (site typography)
    * Body copy: Standard paragraph text
    * All text elements: max-width 600px
    * 40px vertical space between body copy and product card
    PRODUCT CARD:
    * Small, horizontal layout with white background and 8px corner radius
    * Layout (left to right): Product image | Product title (line 1) | Price (line 2)
    * Clicking card navigates to product page
    CAROUSEL FUNCTIONALITY:
    * Support up to 5 slides
    * Auto-adjust to number of slides with content
    * Auto-advance every 30 seconds
    * Transition: Cross-dissolve (both slides fade simultaneously, no fade-to-white)
    * Consistent slide height across all slides
    NAVIGATION CONTROLS:
    * Dot pagination (bottom, centered)
    * Left/right arrow controls alongside dots
    * 20px padding below controls
    * All controls fully functional
    BACKGROUND COLOR:
    * Allow setting background color per individual slide
    EDITOR BEHAVIOR:
    * Only create slide if content is filled out
    * When editing slide content, auto-navigate to that slide for live preview, FIX CAROUSEL NAVIGATION:
    
    Clicking dot pagination or arrow controls is not changing slides - fix navigation functionality so all slides are accessible
    
    ADJUST CONTROL SPACING:
    
    Move the 20px padding from below the slide content to below the navigation controls (dots and arrows)
    
    RESIZE PRODUCT CARD:
    
    Make product card smaller to match the dimensions shown in the Adi√≥s Cometa slide (second screenshot)
    Keep horizontal layout and white background with 8px corner radius, FIX NAVIGATION CONTROLS:
    
    The dot pagination and arrow controls are still not functional - clicking them does not change slides
    Ensure JavaScript/click events are properly connected so clicking any dot navigates to that specific slide and arrows advance forward/backward through slides, can you keep everything as it is, except fix the pagination dots and navigation arrows? when each dot is clicked the user should be taken to the corresponding slide, if the forward arrow is pressed the user should go to the next slide, and if the back arrow is pressed the user should go to the previous slide
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-carousel-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
  }

  .ai-carousel-slides-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .ai-carousel-slide-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.6s ease-in-out;
    pointer-events: none;
  }

  .ai-carousel-slide-{{ ai_gen_id }}.active {
    position: relative;
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .ai-carousel-slide-content-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: center;
    padding: 40px;
  }

  .ai-carousel-image-column-{{ ai_gen_id }} {
    padding: 20px;
  }

  .ai-carousel-image-wrapper-{{ ai_gen_id }} {
    border-radius: 8px;
    overflow: hidden;
    width: 100%;
  }

  .ai-carousel-image-wrapper-{{ ai_gen_id }} img {
    width: 100%;
    height: auto;
    display: block;
  }

  .ai-carousel-image-placeholder-{{ ai_gen_id }} {
    background-color: #f4f4f4;
    width: 100%;
    aspect-ratio: 4 / 3;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
  }

  .ai-carousel-image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 300px;
    max-height: 300px;
  }

  .ai-carousel-text-column-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
  }

  .ai-carousel-heading-{{ ai_gen_id }} {
    max-width: 600px;
    margin: 0 0 16px 0;
  }

  .ai-carousel-subheading-{{ ai_gen_id }} {
    max-width: 600px;
    margin: 0 0 16px 0;
  }

  .ai-carousel-body-{{ ai_gen_id }} {
    max-width: 600px;
    margin: 0 0 40px 0;
  }

  .ai-carousel-product-card-{{ ai_gen_id }} {
    background-color: #ffffff;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: inherit;
    transition: box-shadow 0.3s ease;
    max-width: 280px;
  }

  .ai-carousel-product-card-{{ ai_gen_id }}:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .ai-carousel-product-image-{{ ai_gen_id }} {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    border-radius: 4px;
    overflow: hidden;
  }

  .ai-carousel-product-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-carousel-product-image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-carousel-product-image-placeholder-{{ ai_gen_id }} svg {
    width: 30px;
    height: 30px;
  }

  .ai-carousel-product-info-{{ ai_gen_id }} {
    flex-grow: 1;
  }

  .ai-carousel-product-title-{{ ai_gen_id }} {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: 600;
    line-height: 1.3;
  }

  .ai-carousel-product-price-{{ ai_gen_id }} {
    margin: 0;
    font-size: 13px;
  }

  .ai-carousel-controls-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-top: 32px;
    padding-bottom: 20px;
  }

  .ai-carousel-arrow-{{ ai_gen_id }} {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s ease;
  }

  .ai-carousel-arrow-{{ ai_gen_id }}:hover {
    opacity: 0.7;
  }

  .ai-carousel-arrow-{{ ai_gen_id }} svg {
    width: 24px;
    height: 24px;
  }

  .ai-carousel-dots-{{ ai_gen_id }} {
    display: flex;
    gap: 8px;
  }

  .ai-carousel-dot-{{ ai_gen_id }} {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #d1d1d1;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: background-color 0.3s ease;
  }

  .ai-carousel-dot-{{ ai_gen_id }}.active {
    background-color: #272727;
  }

  @media screen and (max-width: 749px) {
    .ai-carousel-slide-content-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
      gap: 24px;
      padding: 24px;
    }

    .ai-carousel-image-column-{{ ai_gen_id }} {
      padding: 0;
    }
  }
{% endstyle %}

<carousel-block-{{ ai_gen_id }}
  class="ai-carousel-{{ ai_gen_id }}"
  data-autoplay-interval="30000"
  {{ block.shopify_attributes }}
>
  <div class="ai-carousel-slides-{{ ai_gen_id }}">
    {% assign slide_count = 0 %}
    {% for i in (1..5) %}
      {% liquid
        assign heading_key = 'slide_' | append: i | append: '_heading'
        assign subheading_key = 'slide_' | append: i | append: '_subheading'
        assign body_key = 'slide_' | append: i | append: '_body'
        assign image_key = 'slide_' | append: i | append: '_image'
        assign product_key = 'slide_' | append: i | append: '_product'
        assign bg_color_key = 'slide_' | append: i | append: '_bg_color'

        assign heading = block.settings[heading_key]
        assign subheading = block.settings[subheading_key]
        assign body = block.settings[body_key]
        assign image = block.settings[image_key]
        assign product = block.settings[product_key]
        assign bg_color = block.settings[bg_color_key]

        assign has_content = false
        if heading != blank or subheading != blank or body != blank or image != blank or product != blank
          assign has_content = true
          assign slide_count = slide_count | plus: 1
        endif
      %}

      {% if has_content %}
        <div
          class="ai-carousel-slide-{{ ai_gen_id }} {% if slide_count == 1 %}active{% endif %}"
          data-slide-index="{{ slide_count }}"
          style="background-color: {{ bg_color }};"
        >
          <div class="ai-carousel-slide-content-{{ ai_gen_id }}">
            <div class="ai-carousel-image-column-{{ ai_gen_id }}">
              <div class="ai-carousel-image-wrapper-{{ ai_gen_id }}">
                {% if image %}
                  <img
                    src="{{ image | image_url: width: 800 }}"
                    alt="{{ image.alt | escape }}"
                    loading="lazy"
                    width="{{ image.width }}"
                    height="{{ image.height }}"
                  >
                {% else %}
                  <div class="ai-carousel-image-placeholder-{{ ai_gen_id }}">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="ai-carousel-text-column-{{ ai_gen_id }}">
              {% if heading != blank %}
                <h2 class="ai-carousel-heading-{{ ai_gen_id }} h2">{{ heading }}</h2>
              {% endif %}

              {% if subheading != blank %}
                <p class="ai-carousel-subheading-{{ ai_gen_id }} subheading">{{ subheading }}</p>
              {% endif %}

              {% if body != blank %}
                <div class="ai-carousel-body-{{ ai_gen_id }}">{{ body }}</div>
              {% endif %}

              {% if product != blank %}
                <a
                  href="{{ product.url }}"
                  class="ai-carousel-product-card-{{ ai_gen_id }}"
                >
                  <div class="ai-carousel-product-image-{{ ai_gen_id }}">
                    {% if product.featured_image %}
                      <img
                        src="{{ product.featured_image | image_url: width: 120 }}"
                        alt="{{ product.featured_image.alt | escape }}"
                        loading="lazy"
                        width="120"
                        height="120"
                      >
                    {% else %}
                      <div class="ai-carousel-product-image-placeholder-{{ ai_gen_id }}">
                        {{ 'product-1' | placeholder_svg_tag }}
                      </div>
                    {% endif %}
                  </div>
                  <div class="ai-carousel-product-info-{{ ai_gen_id }}">
                    <div class="ai-carousel-product-title-{{ ai_gen_id }}">{{ product.title }}</div>
                    <div class="ai-carousel-product-price-{{ ai_gen_id }}">{{ product.price | money }}</div>
                  </div>
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {% if slide_count > 1 %}
    <div class="ai-carousel-controls-{{ ai_gen_id }}">
      <button
        class="ai-carousel-arrow-{{ ai_gen_id }} ai-carousel-prev-{{ ai_gen_id }}"
        aria-label="Previous slide"
        type="button"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <div class="ai-carousel-dots-{{ ai_gen_id }}">
        {% for i in (1..slide_count) %}
          <button
            class="ai-carousel-dot-{{ ai_gen_id }} {% if i == 1 %}active{% endif %}"
            data-slide="{{ i }}"
            aria-label="Go to slide {{ i }}"
            type="button"
          ></button>
        {% endfor %}
      </div>

      <button
        class="ai-carousel-arrow-{{ ai_gen_id }} ai-carousel-next-{{ ai_gen_id }}"
        aria-label="Next slide"
        type="button"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  {% endif %}
</carousel-block-{{ ai_gen_id }}>

<script>
  (function() {
    if (customElements.get('carousel-block-{{ ai_gen_id }}')) {
      return;
    }

    class CarouselBlock{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentSlide = 1;
        this.autoplayTimer = null;
        this.isTransitioning = false;
      }

      connectedCallback() {
        const self = this;
        setTimeout(function() {
          self.slides = self.querySelectorAll('.ai-carousel-slide-{{ ai_gen_id }}');
          self.dots = self.querySelectorAll('.ai-carousel-dot-{{ ai_gen_id }}');
          self.prevButton = self.querySelector('.ai-carousel-prev-{{ ai_gen_id }}');
          self.nextButton = self.querySelector('.ai-carousel-next-{{ ai_gen_id }}');
          self.autoplayInterval = parseInt(self.dataset.autoplayInterval) || 30000;

          if (self.slides.length <= 1) return;

          self.equalizeSlideHeights();
          self.setupEventListeners();
          self.startAutoplay();
        }, 100);
      }

      setupEventListeners() {
        const self = this;

        if (this.prevButton) {
          this.prevButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            self.previousSlide();
          });
        }

        if (this.nextButton) {
          this.nextButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            self.nextSlide();
          });
        }

        this.dots.forEach(function(dot) {
          dot.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const slideNum = parseInt(this.getAttribute('data-slide'));
            if (slideNum) {
              self.goToSlide(slideNum);
            }
          });
        });

        this.addEventListener('mouseenter', function() {
          self.stopAutoplay();
        });

        this.addEventListener('mouseleave', function() {
          self.startAutoplay();
        });
      }

      equalizeSlideHeights() {
        let maxHeight = 0;
        const self = this;
        
        this.slides.forEach(function(slide) {
          slide.style.position = 'relative';
          slide.style.opacity = '1';
          slide.style.visibility = 'visible';
          const height = slide.offsetHeight;
          if (height > maxHeight) {
            maxHeight = height;
          }
        });

        const slidesContainer = this.querySelector('.ai-carousel-slides-{{ ai_gen_id }}');
        if (slidesContainer) {
          slidesContainer.style.height = maxHeight + 'px';
        }

        this.slides.forEach(function(slide, index) {
          if (index === 0) {
            slide.style.position = 'relative';
            slide.style.opacity = '1';
            slide.style.visibility = 'visible';
          } else {
            slide.style.position = 'absolute';
            slide.style.opacity = '0';
            slide.style.visibility = 'hidden';
          }
        });
      }

      goToSlide(slideIndex) {
        if (this.isTransitioning || slideIndex === this.currentSlide) {
          return;
        }

        if (slideIndex < 1 || slideIndex > this.slides.length) {
          return;
        }

        this.isTransitioning = true;
        const self = this;

        this.slides.forEach(function(slide) {
          slide.classList.remove('active');
        });

        this.dots.forEach(function(dot) {
          dot.classList.remove('active');
        });

        const targetSlide = this.slides[slideIndex - 1];
        const targetDot = this.dots[slideIndex - 1];

        if (targetSlide) {
          targetSlide.classList.add('active');
        }

        if (targetDot) {
          targetDot.classList.add('active');
        }

        this.currentSlide = slideIndex;

        setTimeout(function() {
          self.isTransitioning = false;
        }, 600);

        this.resetAutoplay();
      }

      nextSlide() {
        const nextIndex = this.currentSlide >= this.slides.length ? 1 : this.currentSlide + 1;
        this.goToSlide(nextIndex);
      }

      previousSlide() {
        const prevIndex = this.currentSlide <= 1 ? this.slides.length : this.currentSlide - 1;
        this.goToSlide(prevIndex);
      }

      startAutoplay() {
        this.stopAutoplay();
        const self = this;
        if (this.slides.length > 1) {
          this.autoplayTimer = setInterval(function() {
            self.nextSlide();
          }, this.autoplayInterval);
        }
      }

      stopAutoplay() {
        if (this.autoplayTimer) {
          clearInterval(this.autoplayTimer);
          this.autoplayTimer = null;
        }
      }

      resetAutoplay() {
        this.stopAutoplay();
        this.startAutoplay();
      }

      disconnectedCallback() {
        this.stopAutoplay();
      }
    }

    customElements.define('carousel-block-{{ ai_gen_id }}', CarouselBlock{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Carousel",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Slide 1"
    },
    {
      "type": "image_picker",
      "id": "slide_1_image",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "slide_1_heading",
      "label": "Heading"
    },
    {
      "type": "inline_richtext",
      "id": "slide_1_subheading",
      "label": "Subheading"
    },
    {
      "type": "richtext",
      "id": "slide_1_body",
      "label": "Body text"
    },
    {
      "type": "product",
      "id": "slide_1_product",
      "label": "Product"
    },
    {
      "type": "color",
      "id": "slide_1_bg_color",
      "label": "Background color",
      "default": "#f4f4f4"
    },
    {
      "type": "header",
      "content": "Slide 2"
    },
    {
      "type": "image_picker",
      "id": "slide_2_image",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "slide_2_heading",
      "label": "Heading"
    },
    {
      "type": "inline_richtext",
      "id": "slide_2_subheading",
      "label": "Subheading"
    },
    {
      "type": "richtext",
      "id": "slide_2_body",
      "label": "Body text"
    },
    {
      "type": "product",
      "id": "slide_2_product",
      "label": "Product"
    },
    {
      "type": "color",
      "id": "slide_2_bg_color",
      "label": "Background color",
      "default": "#f4f4f4"
    },
    {
      "type": "header",
      "content": "Slide 3"
    },
    {
      "type": "image_picker",
      "id": "slide_3_image",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "slide_3_heading",
      "label": "Heading"
    },
    {
      "type": "inline_richtext",
      "id": "slide_3_subheading",
      "label": "Subheading"
    },
    {
      "type": "richtext",
      "id": "slide_3_body",
      "label": "Body text"
    },
    {
      "type": "product",
      "id": "slide_3_product",
      "label": "Product"
    },
    {
      "type": "color",
      "id": "slide_3_bg_color",
      "label": "Background color",
      "default": "#f4f4f4"
    },
    {
      "type": "header",
      "content": "Slide 4"
    },
    {
      "type": "image_picker",
      "id": "slide_4_image",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "slide_4_heading",
      "label": "Heading"
    },
    {
      "type": "inline_richtext",
      "id": "slide_4_subheading",
      "label": "Subheading"
    },
    {
      "type": "richtext",
      "id": "slide_4_body",
      "label": "Body text"
    },
    {
      "type": "product",
      "id": "slide_4_product",
      "label": "Product"
    },
    {
      "type": "color",
      "id": "slide_4_bg_color",
      "label": "Background color",
      "default": "#f4f4f4"
    },
    {
      "type": "header",
      "content": "Slide 5"
    },
    {
      "type": "image_picker",
      "id": "slide_5_image",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "slide_5_heading",
      "label": "Heading"
    },
    {
      "type": "inline_richtext",
      "id": "slide_5_subheading",
      "label": "Subheading"
    },
    {
      "type": "richtext",
      "id": "slide_5_body",
      "label": "Body text"
    },
    {
      "type": "product",
      "id": "slide_5_product",
      "label": "Product"
    },
    {
      "type": "color",
      "id": "slide_5_bg_color",
      "label": "Background color",
      "default": "#f4f4f4"
    }
  ],
  "presets": [
    {
      "name": "Carousel"
    }
  ]
}
{% endschema %}
